<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wurm Online – Advanced Shard Analyzer</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app">
    <header class="topbar">
      <div class="title">
        <h1>Wurm Online – Advanced Shard Analyzer</h1>
        <div class="subtitle">Paste shard logs (or Pastebin links) + step offsets. Generates candidate vein map.</div>
      </div>

      <div class="controls">
        <button id="btnAdd" class="btn primary">Add Entry</button>
        <button id="btnUndo" class="btn">Undo</button>
        <button id="btnRedo" class="btn">Redo</button>
        <button id="btnReset" class="btn danger">Reset</button>
        <button id="btnExport" class="btn">Download PNG</button>
      </div>
    </header>

    <main class="main">
      <section class="left">
        <div class="panel">
          <div class="panelHead">
            <h2>Entries</h2>
            <div class="hint">
              Each entry = one shard analysis session at one tile.
              Steps are <b>relative</b> from the previous entry (negative allowed).
            </div>
          </div>

          <div id="entries" class="entries"></div>

          <div class="panelFoot">
            <div class="row">
              <label class="lbl">Grid Size (tiles)</label>
              <input id="gridSize" type="number" value="60" step="1" />
              <label class="lbl">Tile Size (px)</label>
              <input id="tileSize" type="number" value="64" step="1" />
            </div>

            <div class="row">
              <label class="lbl">Max Search Distance (tiles)</label>
              <input id="maxDist" type="number" value="12" step="1" />
              <label class="lbl">Background</label>
              <select id="bgMode">
                <option value="dark" selected>Dark</option>
                <option value="light">Light</option>
              </select>
            </div>

            <div class="row">
              <label class="lbl">Center Map On</label>
              <select id="centerMode">
                <option value="origin" selected>Origin (Entry 1)</option>
                <option value="bounds">Data Bounds</option>
              </select>
            </div>
          </div>
        </div>
      </section>

      <section class="right">
        <div class="canvasWrap">
          <canvas id="map" width="1200" height="900"></canvas>
        </div>

        <div class="legend panel">
          <h2>Legend</h2>
          <div class="legendRow"><span class="swatch s20"></span><span>20–29</span></div>
          <div class="legendRow"><span class="swatch s30"></span><span>30–39</span></div>
          <div class="legendRow"><span class="swatch s40"></span><span>40–59</span></div>
          <div class="legendRow"><span class="swatch s60"></span><span>60–79</span></div>
          <div class="legendRow"><span class="swatch s80"></span><span>80–94</span></div>
          <div class="legendRow"><span class="swatch s95"></span><span>95–99</span></div>
        </div>
      </section>
    </main>
  </div>

  <template id="entryTpl">
    <div class="entry">
      <div class="entryHead">
        <div class="entryTitle">Entry <span class="entryIndex"></span></div>
        <button class="btn small danger btnRemove">Remove</button>
      </div>

      <div class="grid2">
        <div class="field">
          <label>Step East (Δx)</label>
          <input class="stepEast" type="number" value="0" step="1" />
        </div>
        <div class="field">
          <label>Step North (Δy)</label>
          <input class="stepNorth" type="number" value="0" step="1" />
        </div>
      </div>

      <div class="field">
        <label>Log text or Pastebin URL</label>
        <textarea class="log" rows="7" placeholder="[02:49:50] You start to analyse the shard. ..."></textarea>
      </div>

      <div class="entryMeta">
        <div class="metaLine"><b>Computed Tile:</b> <span class="tilePos">(pending)</span></div>
        <div class="metaLine"><b>Detected Veins:</b> <span class="veinCount">0</span></div>
      </div>
    </div>
  </template>

  <script src="app.js"></script>
</body>
</html>
